{% extends "base.html" %}
{% load template_extras %}
{% load humanize %}

{% block title %}Price-per-dose savings for {{ ccg.name }}{% endblock %}
{% block active_class %}ccg{% endblock %}

{% block content %}

<h1>Possible monthly savings over £1,000 for {{ccg.name }}</h1>


<p>There can be wide variation in the price paid across England for
the same presentation of a drug or appliance. Every month we calculate
the average price-per-dose achieved by practices for each
presentation. We then work out what a CCG could save if it was
prescribing at the best decile. This table shows the drugs and
appliances which we identified as having the highest potential monthly
cost savings for {{ ccg.name }} as of {{ date }}.</p>


<table id="price_per_pill" class="table table-condensed">
  <thead>
    <tr>
      <th>
        presentation
      </th>
      <th>
        possible savings
      </th>
      <th>
        target ppd
      </th>
      <th>
        current ppd
      </th>
      <th>
        quantity
      </th>
      <th>
        formulation swap
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Loading...
      </th>
      <td>
      </td>
      <td>
      </td>
      <td>
      </td>
      <td>
      </td>
      <td>
      </td>
    </tr>
  </tbody>

</table>

<a href="{% url 'price_per_dose_api' %}?q={{ ccg.code }}&date={{ date }}&format=csv">Download this data</a>

{% endblock %}

{% block extra_js %}
{% conditional_js 'openprescribing' %}
<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/jquery.dataTables.js"></script>
<script type="text/javascript">
$('#price_per_pill').DataTable({
"ajax": {"url": "/api/1.0/price_per_dose/?entity_code={{ ccg.code }}&date=2016-09-01&format=json", "dataSrc": ""},
"order": [[1, "desc"]],
"columns": [
  {"data": "bnf_code",
    "render": function(data, type, full, meta) {
                var link = '<a href="/data_for_equivalents/'+data+'/'+ full['date'] + '">'+full['name']+'</a>';
                if(full['flag_bioequivalence']) {
                     return '<span class="glyphicon glyphicon-warning-sign" style="color:red"></span>' + link;
                } else {
                    return link;
                }
      }
  },
  {"data": "possible_savings", render: $.fn.dataTable.render.number(',', '.', 2, '£' )},
  {"data": "lowest_decile", render: $.fn.dataTable.render.number(',', '.', 2, '£' )},
  {"data": "price_per_dose", render: $.fn.dataTable.render.number(',', '.', 2, '£' )},
  {"data": "quantity", render: $.fn.dataTable.render.number(',')},
  {"data": "formulation_swap"},
]
  }
  );
// request unknown paranter '0' for row 0, column 0
</script>
{% endblock %}
