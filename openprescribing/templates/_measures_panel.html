{% load template_extras %}

{% if not measure.id %}
<!-- only show sorting and alert signups when showing more than one measure -->
<div class="row" >
  {% if tag_filter.show_message %}
  <h2>Prescribing measures tagged <strong>{{ tag_filter.names|fancy_join }}</strong></h2>
  <div class="alert alert-info">
    {% if tag_filter.details|length == 1 %}
      <p>{{ tag_filter.details.0.description|safe }}</p>
    {% elif tag_filter.details|length > 1 %}
      <dl>
        {% for details in tag_filter.details %}
          <dt>{{ details.name }}</dt>
          <dd>{{ details.description|safe }}</dt>
        {% endfor %}
      </dl>
    {% endif %}
    <p>
      {% if entity_type == 'practice' %}
      <a href="{% url 'measures_for_one_practice' practice.code %}">View all standard measures instead</a>.
      {% else %}
      <a href="{% url 'measures_for_one_ccg' ccg.code %}">View all standard measures instead</a>.
      {% endif %}
    </p>
  </div>
{% else %}
  <h2>Prescribing measures</h2>
  <p>
    We have brought together various prescribing measures to show how this organisation compares with its peers across NHS England.
    These are indicative only, and should be approached with caution.
    {% if entity_type == 'practice' %}
    Each chart shows the results for the individual practice, plus deciles across all practices in the NHS in England.
    {% else %}
    Each chart shows the results for the CCG, plus deciles across all CCGs in the NHS in England.
    {% endif %}
    <a href='{% url 'faq' %}#measureinterpret'>Read more about measures</a>.
  </p>
{% endif %}

  <div class="row">
    <div class="col-md-6">
      {% include '_alert_signup_form.html' %}
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label>Sort prescribing measures by:</label>
        <div class="btn-group" id="order">
          <button type="button" data-orderby="percentile" class="btn btn-default active" aria-label="Percentile">
            Potential for improvement
          </button>
          <button type="button" data-orderby="savings" class="btn btn-default" aria-label="Potential savings">
            Potential savings
          </button>
        </div>
      </div>
      <form class="form" action="">
        <div class="form-group">
          <label>Show measures categorised as:</label>
          <select name="tags" class="form-control js-submit-on-change">
            {% for tag in tag_filter.all_tags %}
              <option value="{{ tag.id }}"{% if tag.selected %} selected{% endif %}>{{ tag.name }}</option>
            {% endfor %}
          </select>
        </div>
      </form>
    </div>
  </div>

</div>
{% endif %}

<p id="perfsummary">Loading...</p>

<div id="measures">
  <div id="charts" class="row">
    <div class="loading-wrapper col-xs-12">
        <hr/>
        <img class="loading" src="/static/img/logo.svg" onerror="this.src='/static/img/ajax-loader.gif';this.onerror=null;" title="Loading icon">
        <br/>Fetching data...
        <br/><br/>
    </div>
  </div>

  <div class="alert alert-warning hidden" id="no-cost-saving-warning">
    There is currently no cost savings data available for these measures
  </div>

  {% verbatim %}
  <script id="summary-panel" type="text/x-handlebars-template">
  <p>{{ performanceDescription }}</p>

  {{ topOpportunity }}

  {{{ costSavings }}}

  </script>
  <div id="overlay"></div>
  <script id="measure-panel" type="text/x-handlebars-template">
  <a name="{{ chartId}}"></a>
  <div id="measure_{{ chartId }}" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 chart" data-id="{{ chartId }}" data-costsaving="{{ costSaving50th }}">
      <div class="panel panel-info">
          <div class="panel-heading">
              <a href="{{ chartTitleUrl }}">{{ chartTitle }}</a>
          </div>
          <div class="panel-body" class="row">
              <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 inner">
                  <p><strong>Why it matters:</strong> {{{ why_it_matters }}}</p>
                  <p><strong>Description:</strong> {{{ description }}}</p>
                 {{#if chartExplanation }}
                  <p><strong>Performance:</strong> {{{ chartExplanation }}}</p>
                 {{/if}}
                  <p><strong>Explore:</strong>
                    <ul>
                     {{#if tagsFocus }}
                     <li>
                       This is a compound measure. <a href="{{ tagsFocusUrl }}">Break it down into its constituent measures.</a>
                     </li>
                     {{/if}}
                     {{#if numeratorCanBeQueried }}
                       {{#if oneEntityUrl }}
                        <li>
                          <a href="{{ oneEntityUrl }}">Break the overall
                           score down into individual presentations</a>
                        </li>
                       {{/if}}
                     {{/if}}
                     {{#if isCCG }}
                       <li>
                         <a href="{{ measureForAllPracticesUrl }}">Split the measure
                           into charts for individual practices</a>
                       </li>
                     {{/if}}
                     <li><a href="{{ measureUrl }}">Compare all CCGs
                     in England on this measure</a></li>
                    </ul>
                  </p>
                  <p>
                    <strong>Tagged as:</strong>
                    {{# each tagsForDisplay as |tag index|}}
                      <a href="?tags={{ tag.id }}">{{ tag.name }}</a>{{#unless @last }}, {{/unless}}
                    {{/each}}
                    {{# unless tagsForDisplay }}<em>No tags yet</em>{{/unless}}
                  </p>
              </div>
              <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6" id="{{ chartId }}">
                  <div class="status"></div>
              </div>
          </div>

      </div>
  </div>
  </script>
  {% endverbatim %}
</div>
