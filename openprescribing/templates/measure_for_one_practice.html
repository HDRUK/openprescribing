{% extends "base.html" %}
{% load humanize %}
{% load template_extras %}

{% block title %}Prescribing on {{ measure.name }} for {{ practice.name }}{% endblock %}
{% block active_class %}practice{% endblock %}

{% block extra_css %}
<link href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
{% endblock extra_css %}

{% block content %}

<h1>{{ practice.name }}: {{ measure.name }}</h2>

<p>In the month for which we have the most recent data ({{ current_at|date:"M Y" }}), the
numerator in this measure is composed of the following presentations:</p>

<table id="numerator_breakdown" class="table">
  <thead>
    <tr>
      <th>
        Presentation
      </th>
      <th>
        Items
      </th>
      <th>
        Quantity
      </th>
      <th>
        Cost
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Loading...
      </th>
      <td>
      </td>
      <td>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

<p>This measure shows how this organisation compares with its peers across NHS England. This is indicative only, and should be approached with caution. <a href='{% url 'faq' %}#measureinterpret'>Read more about measures</a>.</p>

<p id="perfsummary">Loading...</p>

{% include '_measures_panel.html' with entity_type='practice' %}

<p>
  <a href="{% url 'measures_for_one_practice' practice.code %}">View all measures for {{ practice.name }}</a>
</p>

<hr/>

{% include '_get_in_touch.html' %}

<script>
var measureData = {
    'orgId': '{{ practice.code }}',
    'orgName': '{{ practice.name }}',
    'measure': '{{ measure.id }}',
    'rollUpBy': 'measure_id',
    'orgType': 'practice'
};
</script>

{% endblock %}

{% block extra_js %}
{% conditional_js 'measures' %}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs-3.3.7/dt-1.10.15/datatables.min.css"/>

<script type="text/javascript" src="https://cdn.datatables.net/v/bs-3.3.7/dt-1.10.15/datatables.min.js"></script>
<script type="text/javascript">
  $('#numerator_breakdown').DataTable(
    {
      "ajax": {
        "url": "{{ API_HOST }}/api/1.0/measure_numerators_by_org/?org={{ practice.code }}&measure={{ measure.id }}&format=json",
        "dataSrc": ""
      },
      "order": [[1, "desc"]],
      "columns": [
        {"data": "presentation_name", "orderable": false},
        {"data": "total_items",  "className": "dt-right", render: $.fn.dataTable.render.number(',')},
        {"data": "quantity", "className": "dt-right", render: $.fn.dataTable.render.number(',')},
        {"data": "cost", "className": "dt-right", render: $.fn.dataTable.render.number(',', '.', 2, 'Â£' )},
      ]
    }
  );
</script>
{% endblock %}
